<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaDoc to LaTeX 変換ツール</title>
</head>
<body>
    <header>
        <h1 class="box">JavaDoc to LaTeX 変換ツール <span style="font-size: 20px;">ver 1.1.1</span></h1>
    </header>
    <div class="box">
        <p>LaTeX形式で書き出したいクラスについての、JavaDocのhtmlファイルを選択してください。(クラス名.html や インタフェース名.html などのファイル)</p>
        <input type="file" name="" id="fileInput">
    </div>
    <pre id="output" class="box">

    LaTeXのリストがここに書き出されます．
    </pre>
    <div class="box">
        <div class="align-items-center">
            <div class="copyBtn align-items-center" onclick="copy()">
                <svg class="copy" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55.699 55.699" style="enable-background:new 0 0 55.699 55.699;" xml:space="preserve"><g><path style="fill:#010002;" d="M51.51,18.001c-0.006-0.085-0.022-0.167-0.05-0.248c-0.012-0.034-0.02-0.067-0.035-0.1 c-0.049-0.106-0.109-0.206-0.194-0.291v-0.001l0,0c0,0-0.001-0.001-0.001-0.002L34.161,0.293c-0.086-0.087-0.188-0.148-0.295-0.197 c-0.027-0.013-0.057-0.02-0.086-0.03c-0.086-0.029-0.174-0.048-0.265-0.053C33.494,0.011,33.475,0,33.453,0H22.177 c-3.678,0-6.669,2.992-6.669,6.67v1.674h-4.663c-3.678,0-6.67,2.992-6.67,6.67V49.03c0,3.678,2.992,6.669,6.67,6.669h22.677 c3.677,0,6.669-2.991,6.669-6.669v-1.675h4.664c3.678,0,6.669-2.991,6.669-6.669V18.069C51.524,18.045,51.512,18.025,51.51,18.001z M34.454,3.414l13.655,13.655h-8.985c-2.575,0-4.67-2.095-4.67-4.67V3.414z M38.191,49.029c0,2.574-2.095,4.669-4.669,4.669H10.845 c-2.575,0-4.67-2.095-4.67-4.669V15.014c0-2.575,2.095-4.67,4.67-4.67h5.663h4.614v10.399c0,3.678,2.991,6.669,6.668,6.669h10.4 v18.942L38.191,49.029L38.191,49.029z M36.777,25.412h-8.986c-2.574,0-4.668-2.094-4.668-4.669v-8.985L36.777,25.412z M44.855,45.355h-4.664V26.412c0-0.023-0.012-0.044-0.014-0.067c-0.006-0.085-0.021-0.167-0.049-0.249 c-0.012-0.033-0.021-0.066-0.036-0.1c-0.048-0.105-0.109-0.205-0.194-0.29l0,0l0,0c0-0.001-0.001-0.002-0.001-0.002L22.829,8.637 c-0.087-0.086-0.188-0.147-0.295-0.196c-0.029-0.013-0.058-0.021-0.088-0.031c-0.086-0.03-0.172-0.048-0.263-0.053 c-0.021-0.002-0.04-0.013-0.062-0.013h-4.614V6.67c0-2.575,2.095-4.67,4.669-4.67h10.277v10.4c0,3.678,2.992,6.67,6.67,6.67h10.399 v21.616C49.524,43.26,47.429,45.355,44.855,45.355z"/></g></svg>
                <p>コードをコピーする</p>
            </div>
            <div class="copied"></div>
        </div>

        <p class="align-items-center right">
            Created by
            <a class="align-items-center" href="https://twitter.com/AO2324">
                <svg viewBox="0 0 24 24" class="twitter"><g><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"></path></g></svg>
                @AO2324
            </a>
        </p>
    </div>
</body>
<style>
    body {
        margin: 0;
    }
    header {
        padding: 12px 0;
        background-color: rgb(25, 165, 170);
        box-shadow: rgb(71, 71, 71) 0px 0px 10px;
        margin-bottom: 40px;
    }
    h1 {
        margin: 0;
    }
    p {
        margin: 4px 0;
    }
    .box {
        width: 90vw;
        position: relative;
        left: 50%;
        transform: translateX(-50%);
    }
    #output {
        overflow: auto;
        color: white;
        background-color: rgb(47, 47, 47);
        padding: 10px;
        min-height: 300px;
        border: solid gray 4px;
        box-shadow: rgb(102, 102, 102) 2px 2px 3px;
    }
    .copyBtn {
        position: relative;
        border: solid rgb(25, 165, 170) 3px;
        border-radius: 8px;
        font-weight: bold;
        box-shadow: rgb(102, 102, 102) 2px 2px 5px;
        cursor: pointer;
    }
    .copyBtn:hover {
        transform: scale(1.05);
        color: rgb(90, 90, 90);
        border: solid rgb(55, 184, 189) 3px;
        -webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
    }
    .copy {
        padding-right: 7px;
        height: 25px;
    }
    .copied {
        margin-left: 15px;
        opacity: 0;
        animation: copied 0.5s ease-in 0s 1 alternate;
    }
    @keyframes copied {
        0% {opacity: 1;}
        60% {opacity: 1;}
        100% {opacity: 0;}
    }
    .twitter {
        height: 22px;
        fill: rgba(29,161,242,1.00);
    }
    .align-items-center {
        display: inline-flex;
        align-items :center;
        padding: 0 5px;
    }
    .right {
        float: right;
    }
</style>
<script>
let fileName = "";
let fileData = "";
let datinnerTmp2 = "";

const pageFormat = document.getElementById("pageFormat");
const fileInput = document.getElementById("fileInput");
fileInput.addEventListener('change', fileReader, false);

function fileReader(evt){
    var file = evt.target.files;

    //FileReaderの作成
    var reader = new FileReader();
    //テキスト形式で読み込む
    reader.readAsText(file[0]);

    //読込終了後の処理
    reader.onload = function(ev){
        //テキストエリアに表示する
        //document.test.txt.value = reader.result;
        fileData = reader.result;
        fileName = file[0].name;
        //console.log("fileName : "+ fileName + "\ncontent : \n" + fileData);
        //formatChange();
        fileData = new DOMParser().parseFromString(fileData, "text/html");
        //console.log(fileData.getElementsByClassName("title")[0].innerHTML);
        try{
            outputClass();
        } catch(e) {
            output.innerHTML = "指定されたファイルはLaTeXに変換できませんでした...";
        }
    }
}
const output = document.getElementById("output");
function outputClass(){
    let tmp;
    let outputTex = `\\subsection*{`;
    tmp = fileData.getElementsByClassName("title")[0].innerHTML.split(" ");
    outputTex += `${convertToTex(tmp[1])} ${convertToTex(tmp[0])}}\n`;
    outputTex += `\\begin{itemize}\n`;
    let details = fileData.getElementsByClassName("details")[0];
    for(let i = 0; i < details.getElementsByTagName("h3").length; i++){
        //console.log(tmp);
        outputTex += `  \\item ${convertToTex(details.getElementsByTagName("h3")[i].innerText.split("の")[0])}\n`;
        outputTex += `    \\begin{itemize}\n`;
        tmp = details.getElementsByTagName("h3")[i].parentNode.getElementsByTagName("ul");
        for(let j = 0; j < tmp.length; j++){
            let innerTmp = tmp[j].getElementsByTagName("pre")[0];
            let innerTmp2 = innerTmp.getElementsByTagName("a");
            if(innerTmp2.length != 0){
                for(let k = 0; k < innerTmp2.length; k++){
                    innerTmp2[k].insertAdjacentHTML("beforebegin", innerTmp2[k].innerText);
                    innerTmp2[k].remove();
                }
            };
            //console.log(details.getElementsByTagName("h3")[i].parentNode.getElementsByTagName("a")[0]);
            innerTmp = javaSplit(innerTmp.innerText);
            let flag = false;
            try {
                flag = Boolean(details.getElementsByTagName("h3")[i].parentNode.getElementsByTagName("a")[0].outerHTML.match(/constructor/));
            } catch(e) {}
            //console.log(flag);
            try {
                outputTex += `      \\item ${innerTmp[innerTmp.length-1]}: ${(flag)?"":innerTmp[innerTmp.length-2]+" 型，"}${convertToTex(tmp[j].getElementsByClassName("block")[0].innerText)}\n`;
            } catch(e) {
                outputTex += `      \\item ${innerTmp[innerTmp.length-1]}${(flag)?"":": "+innerTmp[innerTmp.length-2]+" 型"}\n`;
            }
        }
        outputTex += `    \\end{itemize}\n`;
    }
    outputTex += `\\end{itemize}`;
    output.innerText = outputTex;

    function javaSplit(text){
        text = text.replace(/\s|&nbsp;/g, " ").replace(/\s{2,}/g, " ").replace(/\n/g, "");
        let ret = [], index = 0, flag = 0;
        for(let i = 0; i < text.length; i++){
            if(text[i] == "<" || text[i] == "(") ++flag;
            else if(text[i] == ">" || text[i] == ")") --flag;
            if(flag == 0 && text[i] == " ") ret.push(text.slice(index, index = i));
            else if(i == text.length-1) ret.push(text.slice(index, i+1));
        }
        for(let r in ret){
            if(ret[r][0] == " ") ret[r] = ret[r].slice(1);
            ret[r] = convertToTex(ret[r]);
        }
        ret = ret.filter(v => v)
        return ret;
    }
    function convertToTex(text){
        return text.replace(/\s|&nbsp;/g, " ").replace(/\s{2,}/g, " ").replace(/\n/g, "").replace(/#/g, "\\#").replace(/%/g, "\\%").replace(/_/g, "\\_").replace(/\$/g, "\\$").replace(/&/g, "\\&").replace(/{/g, "\{").replace(/}/g, "\\}").replace(/\|/g, "\\textbar ").replace(/</g, "\\textless ").replace(/>/g, "\\textgreater ").replace(/~/g, "\\textasciitilde ").replace(/\^/g, "\\textasciicircum ");
    }

}
function copy() {
    let text = document.getElementById("output").innerText;
    let area = document.createElement("textarea");
    area.textContent = text;
    document.body.appendChild(area);
    area.select();
    document.execCommand("copy");
    document.body.removeChild(area);
    let copied = document.getElementsByClassName("copied");
    for(let i in copied)
        copied[i].outerHTML = `<div class="copied">コピー完了！</div>`;
}


</script>
</html>